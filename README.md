# s2dood

**StarCraft II terrain `Objects` file parser and exporter.**

In its current stage it has one purpose: export doodads from a given map, then import them back in a format that allows to query it from triggers. How it will be used and in what way is up to the user.

### F.A.Q.

>Is it compatible with Trigger Editor?

Yes.

>Why doesn't it export data as an `UserData.xml` file?

Because `UserData` API is simply slow. Any performance sensitive use-case of this tool would likely require transfering all entries from `UserData` to galaxy variables. This vastly improves the performance, by taking advantage of static linking within Galaxy. We're avoiding overhead that would come from using `UserData` API to query data dynamically.

## How to use it

### Installation

**Windows**

Download portable binary from [releases](https://github.com/Talv/sc2-dood/releases).

**Linux**

```sh
npm install -g git+https://git@github.com/Talv/sc2-dood.git
```

### Usage

It's command line tool.

```
Usage: s2dood [options] [command]

Options:

  -V, --version                   output the version number
  -h, --help                      output usage information

Commands:

  dump <in-objects> <out-galaxy>
```

### Integration with SC2Map

1. Save the map as `.SC2Components`
2. Run command `tdood.exe dump map.SC2Map\Objects map.SC2Map\objs-doodads.galaxy`

## Example map

Download [tdood-example1](https://github.com/Talv/sc2-dood/releases/download/v0.2.0/tdood-example1.zip)

- Press <kbd>Z</kbd> to clear all preplaced doodads.
- Press <kbd>X</kbd> recreate actors respecting all properties from previously dumped data
- Use wrapper batch file `s2dood-run.bat`, to re-read data from `Objects` file of a map

---

## Explanation: Galaxy script

Data is exported as a `.galaxy` file. Which consists of one function that populates global array. Every element of an array is a struct that includes all relevant properties of a doodad.

Declarations required by generated script. Prefixes such as `gv_` (etc.) makes it Trigger Editor compatible.

```cs
const int gv_doodadsLimit = 16384;

struct gs_PreplacedDoodadT {
    string lv_type;
    int lv_flags;
    int lv_variation;
    fixed lv_x;
    fixed lv_y;
    fixed lv_z;
    fixed lv_yaw;
    fixed lv_pitch;
    fixed lv_roll;
    fixed lv_scale_x;
    fixed lv_scale_y;
    fixed lv_scale_z;
    color lv_tint_col;
    fixed lv_tint_hdr;
    int lv_teamc;
    // --- extra vars filled on the runtime
    string lv_model;
};


// ====
// global variables that will be populdated by generated .galaxy file
// ====

// array of structures - each element of an structure describes one Terrain Doodad
gs_PreplacedDoodadT[gv_doodadsLimit + 1] gv__o;

// number of used entries from above array
int gv__oc = 0;
```

Example of `.galaxy` script generated by this tool. There's just one function - when called it will populate our global array.

```cs
void gf__opopulate() {
gv__o[0].lv_type = "ZerusLargeTree";
gv__o[0].lv_x = 80.5;
gv__o[0].lv_y = 38.5;
gv__o[0].lv_z = 7.9995;
gv__o[0].lv_scale_x = 1;
gv__o[0].lv_scale_y = 1;
gv__o[0].lv_scale_z = 1;
gv__o[0].lv_yaw = -87.129692;
gv__o[0].lv_pitch = -19.469106;
gv__o[0].lv_roll = -0.95110994;
gv__o[0].lv_flags = 0xd00;
// ---
// ... 16k more objects
// ---
gv__oc = 16000;
}
```
